var Projector=new Class({Implements:[Events],_parameters:{target:null,queue:null,preloader:null,preload_priority:"FIRST",autoplay:true,pause_on_hover:false,pause_on_change:true,shuffle:false,display_duration:10,transition:"crossfade",transition_duration:1,easing:"Fx.Transitions.linear",fullscreen:false,rendering_priority:"BALANCED",debug:false},_protected:{container:null,stack:[],initiated:null,complete:false,timeout:null,animating:false,paused:null,active:null},initialize:function(a){this.overrideDefaultParameters(a||{});this.initParameterAPI();if(!this.container(new ProjectorNS.Container({target:$(this.target())})).element())throw"The containing element is required but was not passed in or could not be found.";if(!this.queue()&&this.container().element().getChildren().length===0)throw"The collection of slide objects (stack) was not passed in and the container holds no child elements.";this.initUI();this.initLifecycle();this.load();return this},overrideDefaultParameters:function(a){for(var b in this._parameters){if(typeof a[b]!=="undefined"){this._parameters[b]=a[b]}}return this},initParameterAPI:function(){var a,b;for(b in Object.merge(this._parameters,this._protected)){a=b.replace(/_[a-z]{1}/g,function(a){return a.substr(-1).toUpperCase()});if(!this[a]){this[a]=this.accessor.bind(this,b)}}return this},accessor:function(a,b){if(typeof b!=="undefined"){this._parameters[a.replace(/_[a-z]{1}/g,function(a){return a.substr(-1).toUpperCase()})]=b}return this._parameters[a]},autoplay:function(a){if(typeof a!=="undefined"){this._parameters.autoplay=a;if(this._parameters.autoplay){this.initTimer();this.initPauseOnHover()}else{clearTimeout(this.timeout());this.container().element().removeEvents("mouseover");this.container().element().removeEvents("mouseout")}}return this._parameters.autoplay},fullscreen:function(a){if(typeof a!=="undefined"){this._parameters.fullscreen=a;this.positionAndScale()}return this._parameters.fullscreen},preloadPriority:function(a){if(typeof a!=="undefined"){this._parameters.preload_priority=a}if(!["FIRST","FIRST_LOADED","ADJACENT","STACK"].contains(this._parameters.preload_priority)){this.log("Priority rule "+this._parameters.preload_priority+" is invalid, switching to FIRST (file).");this.preloadPriority("FIRST")}return this._parameters.preload_priority.toUpperCase()},renderingPriority:function(a){if(typeof a!=="undefined"){this._parameters.rendering_priority=a}if(!["BALANCED","PERFORMANCE","QUALITY"].contains(this._parameters.rendering_priority)){this.log("Rendering priority "+this._parameters.rendering_priority+" is invalid, switching to BALANCED.");this.renderingPriority("BALANCED")}return this._parameters.rendering_priority.toUpperCase()},transition:function(a){if(typeof a!=="undefined"){this._parameters.transition=a}return this._parameters.transition.toLowerCase()},easing:function(a){if(typeof a!=="undefined"){this._parameters.easing=a}if(this._parameters.easing&&typeof this._parameters.easing!=="function"){var b=this._parameters.easing.split("."),c=window;while(b.length>0){c=c[b.shift()]}this._parameters.easing=c}return this._parameters.easing},initUI:function(){this.positionAndScaleContainer();if(this.preloader()){this.preloader().call(this)}},initLifecycle:function(){this.addEvent(ProjectorNS.LOADED,this.auditLoadState.bind(this));this.addEvent(ProjectorNS.READY,this.initDisplay.bind(this));if(this.autoplay()){this.addEvent(ProjectorNS.COMPLETE,this.initTimer.bind(this));this.addEvent(ProjectorNS.COMPLETE,this.initPauseOnHover.bind(this))}this.addEvent(ProjectorNS.WILL_TRANSITION_IN,this.positionAndScaleSlide.bind(this));window.onresize=function(){this.positionAndScale()}.bind(this);return this},load:function(){if(!this.queue()){this.queue(this.container().element().getChildren())}if(this.shuffle()){queue=function(a){var b=a;for(var c,d,e=b.length;e;c=parseInt(Math.random()*e),d=b[--e],b[e]=b[c],b[c]=d);return b}(this.queue())}switch(this.preloadPriority()){case"FIRST":this.log("Loading using FIRST (file) priority rules.");this.consume(this.queue(),true);this.stack().pick().addEvent(ProjectorNS.COMPLETE,function(){this.stack().filter(function(a){return!a.complete()}).each(function(a){a.load()})}.bind(this));this.stack().pick().load();break;case"ADJACENT":this.log("Loading using ADJACENT priority rules.");if(this.queue().length>3){this.consume(this.queue().splice(0,2));this.consume(this.queue().splice(0,this.queue().length-1),true);this.push(this.queue().getLast());this.addEvent(ProjectorNS.WILL_TRANSITION_IN,function(a,b){var c=this.stack().indexOf(a)+1;if(c>1&&a!==this.stack().getLast()){this.at(c).load()}}.bind(this))}else{this.log("Insufficient slide count for ADJACENT priority rules, switching to STACK.");this.preloadPriority("STACK");this.load()}break;default:this.log("Loading using default priority rules.");this.consume(this.queue());break}return this},consume:function(a,b){a.each(function(a){this.push(a,b)}.bind(this))},push:function(a,b){var c,d;if($(a)){d={target:a};for(var e,f=0,g=d.target.attributes,h=g.length;f<h;f++){e=g.item(f);if(e.nodeName.match(/^data/)){d[e.nodeName.replace(/^data-([\-_a-z0-9]+)$/i,"$1").replace(/-/g,"_").toLowerCase()]=e.nodeValue}}}else{d=a}Object.merge(d,{rendering_priority:this.renderingPriority(),debug:this.debug()});c=new ProjectorNS.Slide(d);c.addEvent(ProjectorNS.COMPLETE,function(){this.fireEvent(ProjectorNS.LOADED,this)}.bind(this));this.stack().push(b?c:c.load());return this},auditLoadState:function(a){var b=false,c=false;b=this.stack().every(function(a){return a.complete()});switch(this.preloadPriority()){case"ADJACENT":this.log("Auditing using ADJACENT priority rules.");b=c=Array.clone(this.stack()).splice(0,2).every(function(a){return a.complete()})&&this.stack().getLast()&&this.stack().getLast().complete();break;case"STACK":this.log("Auditing using STACK priority rules.");c=b;break;default:this.log("Auditing using default priority rules.");c=this.stack().some(function(a){return a.complete()});break}if(!this.initiated()&&c){this.log("Preload conditions met.");this.fireEvent(ProjectorNS.READY,this)}if(!this.complete()&&b){this.log("Loading is complete.");this.complete(true);this.fireEvent(ProjectorNS.COMPLETE,this)}return this},initDisplay:function(a){var b=this.stack().filter(function(a){return a.complete()}).pick();this.initiated((new Date).getTime());if(this.container().element().getChildren().pick()!==b.element()){this.play(b,true)}return this},positionAndScale:function(a){this.positionAndScaleContainer();this.stack().each(function(a){this.positionAndScaleSlide(a)}.bind(this));return this},positionAndScaleContainer:function(){if(this.fullscreen()){this.container().scaleToViewport()}else{this.container().reset()}return this},positionAndScaleSlide:function(a){var b=this.container().element().getSize(),c=this.container().element().getPosition();a.positionAndScale(b.x,b.y);return this},initTimer:function(a,b){var c=((new Date).getTime()-(b?this.paused():this.initiated()))/1e3;this.log("Setting autoplay timer.");if(c>=this.displayDuration()){this.play()}else{this.timeout(this.play.delay((this.displayDuration()-c)*1e3,this))}return this},initPauseOnHover:function(){if(this.pauseOnHover()){this.container().element().addEvent("mouseover",this.pause.bind(this));this.container().element().addEvent("mouseout",this.initTimer.pass([null,true],this))}},play:function(a,b){this.paused(null);clearTimeout(this.timeout());if(!this.animating()){if(!a){queued=this.next()}else{queued=a;if(!b&&this.pauseOnChange()){this.autoplay(false)}}this.active(ProjectorNS[queued.transition()||this.transition()](this,this.active(),queued));if(!b&&this.autoplay()){this.timeout(this.play.delay(this.displayDuration()*1e3,this))}}return this},pause:function(){clearTimeout(this.timeout());this.paused((new Date).getTime());this.log("Pausing playback.")},next:function(){return this.index()+1<this.stack().length?this.at(this.index()+1):this.stack().pick()},previous:function(){return this.index()-1>=0?this.at(this.index()-1):this.stack().getLast()},index:function(){return this.stack().indexOf(this.active())},at:function(a){return this.stack()[a]},log:function(a){this.debug()&&console&&console.log(a)}});var ProjectorNS={LOADED:"PROJECTOR:loaded",READY:"PROJECTOR:ready",COMPLETE:"PROJECTOR:complete",WILL_TRANSITION_IN:"PROJECTOR:will_transition_in",WILL_TRANSITION_OUT:"PROJECTOR:will_transition_out",HAS_TRANSITIONED_IN:"PROJECTOR:has_transitioned_in",HAS_TRANSITIONED_OUT:"PROJECTOR:has_transitioned_out",Container:new Class({_protected:{element:null,state:null},initialize:function(a){this.element($(a.target));this.element().setStyles({position:"relative",overflow:"hidden"});this.state(this.element().getStyles("position","width","height","top","left"));return this},element:function(a){if(typeof a!=="undefined"){this._protected.element=a}return this._protected.element},state:function(a){if(typeof a!=="undefined"){this._protected.state=a}return this._protected.state},scaleToViewport:function(){var a=window.getSize();this.element().setStyles({position:"fixed",width:a.x+"px",height:a.y+"px",top:0,left:0});return this},reset:function(){this.element().setStyles(this.state());return this}}),Slide:new Class({Implements:[Events],_parameters:{target:null,class_name:null,transition:null,easing:null,anchor:["CENTRE","CENTRE"],rendering_priority:null,debug:false},_protected:{element:null,aspect:null,complete:false},initialize:function(a){this.overrideDefaultParameters(a);this.initParameterAPI();this.initLifecycle();return this},overrideDefaultParameters:function(a){for(var b in a){this._parameters[b]=a[b]}return this},initParameterAPI:function(){var a,b;for(b in Object.merge(this._parameters,this._protected)){a=b.replace(/_[a-z]{1}/g,function(a){return a.substr(-1).toUpperCase()});if(!this[a]){this[a]=this.accessor.bind(this,b)}}return this},accessor:function(a,b){if(typeof b!=="undefined"){this._parameters[a.replace(/_[a-z]{1}/g,function(a){return a.substr(-1).toUpperCase()})]=b}return this._parameters[a]},anchor:function(a){if(typeof a!=="undefined"){this._parameters.anchor=a}if(typeof this._parameters.anchor==="string"){this._parameters.anchor=this._parameters.anchor.split(",").map(function(a){return a.replace(/\s/g,"")})}return this._parameters.anchor.invoke("toUpperCase")},easing:function(a){if(typeof a!=="undefined"){this._parameters.easing=a}if(this._parameters.easing&&typeof this._parameters.easing!=="function"){var b=this._parameters.easing.split("."),c=window;while(b.length>0){c=c[b.shift()]}this._parameters.easing=c}return this._parameters.easing},initLifecycle:function(){this.addEvent(ProjectorNS.LOADED,this.auditLoadState.bind(this));this.addEvent(ProjectorNS.COMPLETE,this.initDisplay.bind(this));return this},load:function(){var a=this,b;this.log("Loading: "+this.target());if(typeof this.target()!=="string"){this.element(this.target())}else if(this.target().match(/^[\-_a-z0-9]+$/i)){this.element($(this.target()))}else{this.element(new Element("img",{src:this.target()}))}if(this.className()){this.element().addClass(this.className())}if(this.element().getStyle("display")==="none"){this.element().dispose()}b=this.element().get("tag")==="img"?[this.element()]:this.element().getElements("img");if(b.length>0){b.each(function(b){switch(this.renderingPriority()){case"PERFORMANCE":b.setStyles({"-ms-interpolation-mode":"nearest-neighbor","image-rendering":"-moz-crisp-edges"});break;case"QUALITY":b.setStyles({"-ms-interpolation-mode":"bicubic","image-rendering":"optimizeQuality"});break}if(!b.complete){b.addEvent("load",function(b){a.fireEvent(ProjectorNS.LOADED,a)})}else{a.fireEvent(ProjectorNS.LOADED,a)}}.bind(this))}else{this.fireEvent(ProjectorNS.LOADED,this)}return this},auditLoadState:function(a){var b=this.element().get("tag")==="img"?[this.element()]:this.element().getElements("img");if(b.length===0||b.every(function(a){return a.complete})){this.complete(true);this.fireEvent(ProjectorNS.COMPLETE,this)}return this},initDisplay:function(a){this.element().setStyles({position:"absolute",overflow:"hidden"})},positionAndScale:function(a,b){var c,d=0,e=0;if(this.element()){if(this.element().get("tag")!=="img"){this.element().setStyles({width:a+"px",height:b+"px",top:d+"px",left:e+"px"})}else{if(!this.aspect()){c=Element.measure(this.element(),function(){return this.getSize()});this.aspect(c.x/c.y)}if(a/this.aspect()<b){c={x:b*this.aspect(),y:b}}else{c={x:a,y:a/this.aspect()}}this.element().setStyles({width:c.x+"px",height:c.y+"px"});if(this.anchor().indexOf("LEFT")>=0){this.element().setStyles({left:e+"px"})}else if(this.anchor().indexOf("RIGHT")>=0){this.element().setStyles({left:e-(c.x-a)+"px"})}else{this.element().setStyles({left:e-(c.x-a)/2+"px"})}if(this.anchor().indexOf("TOP")>=0){this.element().setStyles({top:d+"px"})}else if(this.anchor().indexOf("BOTTOM")>=0){this.element().setStyles({top:d-(c.y-b)+"px"})}else{this.element().setStyles({top:d-(c.y-b)/2+"px"})}}}return this},log:function(a){this.debug()&&console&&console.log(a)}}),crossfade:function(a,b,c){var d=1,e;if(!isNaN(a.container().element().getStyle("z-index"))){a.container().element().getStyle("z-index")}c.element().setStyles({display:"block",opacity:"0","z-index":d+1});c.element().inject(a.container().element(),"top");if(b){b.element().setStyle("z-index",d);a.fireEvent(ProjectorNS.WILL_TRANSITION_OUT,[b,a])}e=new Fx.Morph(c.element(),{duration:a.transitionDuration()*1e3,transition:c.easing()||a.easing()});e.addEvent("start",function(){a.animating(true);a.fireEvent(ProjectorNS.WILL_TRANSITION_IN,[c,a])});e.addEvent("complete",function(){a.fireEvent(ProjectorNS.HAS_TRANSITIONED_IN,[c,a]);if(b){b.element().dispose();a.fireEvent(ProjectorNS.HAS_TRANSITIONED_OUT,[b,a])}a.animating(false)});e.start({opacity:[0,1]});return c},fade:function(a,b,c){var d,e,f;if(!b){f=new Element("div")}d=new Fx.Morph(f||b.element(),{duration:!f?a.transitionDuration()*1e3/2:0,transition:c.easing()||a.easing()});e=new Fx.Morph(c.element(),{duration:a.transitionDuration()*1e3/2,transition:c.easing()||a.easing()});d.addEvent("start",function(){a.animating(true);if(b){a.fireEvent(ProjectorNS.WILL_TRANSITION_OUT,[b,a])}});d.addEvent("complete",function(){if(b){b.element().dispose();a.fireEvent(ProjectorNS.HAS_TRANSITIONED_OUT,[b,a])}else{f.dispose()}c.element().setStyles({display:"block",opacity:"0"});c.element().inject(a.container().element(),"top");a.fireEvent(ProjectorNS.WILL_TRANSITION_IN,[c,a]);e.start({opacity:[0,1]})});e.addEvent("complete",function(){a.fireEvent(ProjectorNS.HAS_TRANSITIONED_IN,[c,a]);a.animating(false)});d.start({opacity:[1,0]});return c},slideLeft:function(a,b,c){},slideRight:function(a,b,c){},slideUp:function(a,b,c){},slideDown:function(a,b,c){},carouselLeft:function(a,b,c){},carouselRight:function(a,b,c){},carouselUp:function(a,b,c){},carouselDown:function(a,b,c){}}